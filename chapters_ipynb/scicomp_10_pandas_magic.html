

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6. Data reduction and analysis magic with Pandas &#8212; Introduction to Computation for the Physics Sciences</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters_ipynb/scicomp_10_pandas_magic';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Text as data" href="scicomp_06_textasdata.html" />
    <link rel="prev" title="5. Manipulating tabular data with Pandas" href="scicomp_09_pandas.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/wj_horiz_color.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/wj_horiz_color.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">I. Python basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scicomp_00_basics.html">1. Basic syntax, variables, functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_01_controlstructs.html">2. Control structures, numerical integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_02_typescontainers.html">3. Types, random numbers, lists, dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_03_fileio.html">4. File I/O</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">II. Techniques for the physical sciences</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scicomp_04_datavis.html">1. Data visualization with <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_05_fitting.html">2. Fitting models to data</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_07_ODEs.html">3. Simulating solutions to differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_08_montecarlo.html">4. Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_09_pandas.html">5. Manipulating tabular data with <code class="docutils literal notranslate"><span class="pre">Pandas</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. Data reduction and analysis magic with <code class="docutils literal notranslate"><span class="pre">Pandas</span></code></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">III. Optional (but fun)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scicomp_06_textasdata.html">1. Text as data</a></li>
<li class="toctree-l1"><a class="reference internal" href="scicomp_11_circuitpython.html">2. Python on microcontrollers with <code class="docutils literal notranslate"><span class="pre">circuitpython</span></code></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">IV. Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scicomp_proj_z0_ll_analysis.html">Di-lepton mass spectrum from the Compact Muon Solenoid</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters_ipynb/scicomp_10_pandas_magic.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters_ipynb/scicomp_10_pandas_magic.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data reduction and analysis magic with Pandas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">6.1. Recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">6.2. Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-reduction">6.3. Data reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#netflix-data">Netflix data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-do-we-want-to-know">What do we want to know?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apply"><code class="docutils literal notranslate"><span class="pre">apply</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-example-1"><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-example-2"><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-example-3"><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#warm-up-problem-must-do-this">Warm-up problem (must do this!)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#warm-up-problem">Warm-up problem</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Warm-up problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-ordering-the-dataset-sort-values">6.4. Re-ordering the dataset –&gt; <code class="docutils literal notranslate"><span class="pre">sort_values</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">6.5. Data reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#groupby"><code class="docutils literal notranslate"><span class="pre">groupby</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#agg"><code class="docutils literal notranslate"><span class="pre">agg</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-about-science-though">6.6. What about science, though?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#astronomy-crash-course-from-a-particle-physicist">Astronomy crash-course (from a particle physicist)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-z-values-for-different-classes-of-objects">Mean <span class="math notranslate nohighlight">\(z\)</span> values for different classes of objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#it-s-science-time">It’s science time!</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-summary">6.7. In summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problems">6.8. Problems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regulars">Regulars</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-1">Problem 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-2">Problem 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-3">Problem 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-4">Problem 4</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-meanies">Semi-meanies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-5">Problem 5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-6">Problem 6</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meanie-1-netflix-economist">Meanie 1 – Netflix Economist</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meanie-2-star-sleuth">Meanie 2 – Star Sleuth</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-reduction-and-analysis-magic-with-pandas">
<h1><span class="section-number">6. </span>Data reduction and analysis magic with <code class="docutils literal notranslate"><span class="pre">Pandas</span></code><a class="headerlink" href="#data-reduction-and-analysis-magic-with-pandas" title="Permalink to this heading">#</a></h1>
<section id="recap">
<h2><span class="section-number">6.1. </span>Recap<a class="headerlink" href="#recap" title="Permalink to this heading">#</a></h2>
<p>In the previous lesson we covered some of the basics of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>:</p>
<ul class="simple">
<li><p>creating dataframes from series(es)</p></li>
<li><p>writing a dataframe to file</p></li>
<li><p>reading a dataframe from file</p></li>
<li><p>accessing rows and columns within a dataframe</p></li>
<li><p>accessing subsets of data within a dataframe based on values meeting some conditions</p></li>
<li><p>creating new columns in a dataframe</p></li>
</ul>
<p>If you’re like most people, you’re probably thinking “Wow, that is all very fancy (<em>i.e.</em>, confusing), but I’ll stick with my Excel spreadsheets, k thx bye.”  In this lesson, we’ll see some of the true magic of <code class="docutils literal notranslate"><span class="pre">pandas</span></code> that makes it (or something like it) an essential tool for meaningful data analysis.</p>
</section>
<hr class="docutils" />
<section id="motivation">
<h2><span class="section-number">6.2. </span>Motivation<a class="headerlink" href="#motivation" title="Permalink to this heading">#</a></h2>
<p>Data analysis is an incredibly powerful way of knowing things.  In general, the larger a dataset is (the more “robust” it is), the more confident we can be that the results derived from that dataset are significant.  We want to be confident that our results reflect general features fo the system we’re studying and not some weird statistical fluctuation, and <em>big</em> datasets are generally the way to achieve this.</p>
<p>For example, it would be a bad idea to study the average height of human beings by looking at a dataset containing the heights of only the 5 starting players on the 2023 Denver Nuggests basketball team.  Big datasets are important for making sure that we’re doing careful science.</p>
<p>That said, quanttative data in large amounts can be difficult for us humans to process.  If you opened a spreadsheet containing, say, 5 rows of human height data you might be able to glance through the individual heights, ballpark the average height at 6’8”, and determine that something is really funky with the data.  (“Are these people all pro basketbal players?”)  If, however, you opened a spreadsheet containing height measurements for all of the 12.96 million residents of the state of Pennsylvania your eyes might glaze over in panic and you might just trust whatever results a researcher derived from the data.  Large amounts of data are simply overwhelming to our squishy human brains.</p>
<p>A beautiful illustration of this is the 2021 scientific misconduct scandal surrounding Dan Ariely, a Duke University Professor of Psychology and popular science author.  Ariely rose to national attention due in part to really good-sounding “results” from studies of human behavior, many of which focused on honesty.  In 2021, a team of data sleuths at Data Colada uncovered rather blatant data fabrication and manipulation in Ariely’s work.  Ariely’s subterfuge relied on the assumption that the dataset he was working with was too big for anyone to ever want to check his math.  Oops!</p>
<p>There are many great articles about this online.  I strongly recommend learning more about this, as it’s a great example of how not to do science.</p>
<ul class="simple">
<li><p>Planet Money. <a class="reference external" href="https://open.spotify.com/episode/2Bse6AcwmJdHRE1hesMUxD?si=lWZfomnqQS-GyhtEPvj1-A">Did two honesty researchers fabricate their data?</a></p></li>
<li><p>Data Colada. <a class="reference external" href="https://datacolada.org/98">Evidence of Fraud in an Influential Field Experiment About Dishonesty</a></p></li>
<li><p>The New Yorker. <a class="reference external" href="https://www.newyorker.com/magazine/2023/10/09/they-studied-dishonesty-was-their-work-a-lie">They Studied Dishonesty. Was Their Work a Lie?</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="data-reduction">
<h2><span class="section-number">6.3. </span>Data reduction<a class="headerlink" href="#data-reduction" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Data_reduction">Wikipedia</a> tells us that</p>
<blockquote>
<div><p><strong>Data reduction</strong> is the transformation of numerical or alphabetical digital information derived empirically or experimentally into a corrected, ordered, and simplified form. The purpose of data reduction can be two-fold: reduce the number of data records by eliminating invalid data or <em>produce summary data and statistics at different aggregation levels for various applications</em>.</p>
</div></blockquote>
<p>The italicized text is what we’re after here.  In previous lessons, we’ve learned how to do things like fit models to data to generate results.  Data reduction is the process that happens before that.  Data reduction often means taking a large amount of raw data and collapsing, massaging, and processing it into a smaller set of data from which we can generate results.  The term “data reduction” seems to have been replaced with the more general “data analysis,” but it’s good to know what reduction is a particular step in many scientific processes.</p>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code> is an amazing tool for data reduction.  It can do quite easily some things that MS Excel (and similar) would just cry about.  We’ll investigate these capabilities with a fairly easy-to-understand example.</p>
<section id="netflix-data">
<h3>Netflix data<a class="headerlink" href="#netflix-data" title="Permalink to this heading">#</a></h3>
<p>On 12 Dec 2023 Netflix <a class="reference external" href="https://about.netflix.com/en/news/what-we-watched-a-netflix-engagement-report">broke its silence</a> about the popularity of content on its platform between.  Prior to this, Netflix would rank its top performers, but wouldn’t release any absolute data on how much people watched each show/movie what it calls “engagement”.  The report that Netflix released gives viewership information for titles between January and June of 2023.  A <code class="docutils literal notranslate"><span class="pre">csv</span></code> file of this data exists in the <code class="docutils literal notranslate"><span class="pre">data_files/</span></code> directory.  Let’s load it up!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">netflix_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_files/netflix_engagement_report_2023jan-jun.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is a fairly big dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arrested Development: Season 1</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>17,600,000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arrested Development: Season 3</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>7,000,000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arrested Development: Season 2</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>11,300,000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Trailer Park Boys: Season 1</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,400,000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trailer Park Boys: Season 2</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,800,000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trailer Park Boys: Season 4</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Trailer Park Boys: Season 3</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Trailer Park Boys: Season 5</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>8,400,000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Trailer Park Boys: Season 7</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>7,500,000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Trailer Park Boys: Season 6</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>4,800,000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18204</th>
      <td>Špindl</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18205</th>
      <td>Żyć nie umierać</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18206</th>
      <td>الناموس: Season 1</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18207</th>
      <td>حكايات بنات الجزء ١: Season 2</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18208</th>
      <td>حكايات بنات الجزء ١: Season 3</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18209</th>
      <td>راس السنة</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18210</th>
      <td>心が叫びたがってるんだ。</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18211</th>
      <td>두근두근 내 인생</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18212</th>
      <td>라디오 스타</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
    <tr>
      <th>18213</th>
      <td>선생 김봉두</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(18214, 4)
</pre></div>
</div>
</div>
</div>
<p>OK, so the dataframe contains title, availability, premier/release date, and hours watched for… 18,214 titles!  Yikes!  It also looks like the titles are ordered by the date that they became available, which is perhaps not super convenient.  It <strong>is</strong> nice to see <em>Arrested Development</em>, though!  Note that there are titles with non-Enlgish characters in them – cool!  There are also titles that don’t have a release date; <code class="docutils literal notranslate"><span class="pre">NaN</span></code> is pythonic for ‘not a number’.</p>
<p>You can maybe guess why a dataset like this might be very helpful to a company.  If they can determine features of the most-watched shows and find a way to make more of the same for less money, they can make ~~more crap that maximizes shareholder value~~ art that helps us understand what it means to be human.  Still, though, we need to do some analysis on this dataset in order to extract meaning/understanding from it.</p>
</section>
<hr class="docutils" />
<section id="what-do-we-want-to-know">
<h3>What do we want to know?<a class="headerlink" href="#what-do-we-want-to-know" title="Permalink to this heading">#</a></h3>
<p>At this point, I think that it will be helpful to establish a few research questions that we can investigate with this dataset.</p>
<ol class="arabic simple">
<li><p>What was the most-viewed title during this period?</p></li>
<li><p>What’s more popular, TV shows or movies?</p></li>
<li><p>What was the total watch time for the titles in this dataset?</p></li>
<li><p>How many unique properties are there in the dataset?  (<em>I.e.</em>, multiple seasons of the same show count as a single property.)</p></li>
<li><p><strong>Brainstorm as a group and add your questions here!</strong></p></li>
</ol>
<p>What we want to know will guide which tools we use.</p>
</section>
<hr class="docutils" />
<section id="apply">
<h3><code class="docutils literal notranslate"><span class="pre">apply</span></code><a class="headerlink" href="#apply" title="Permalink to this heading">#</a></h3>
<section id="apply-example-1">
<h4><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 1<a class="headerlink" href="#apply-example-1" title="Permalink to this heading">#</a></h4>
<p>First, you may notice that the Hours Viewed column is a total pain – Netflix has presented these large numbers with commas in them, which means that they appear in the dataframe as strings.  We need to fix this by producing a column of numerical values.</p>
<p>Let’s begin by writing a function which converts a single string such as this to an integer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_bad_number</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># replaces commas with nothing</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span>      <span class="c1"># unit conversion, divides by 1 million</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="n">convert_bad_number</span><span class="p">(</span><span class="s1">&#39;1,234,567&#39;</span><span class="p">)</span> <span class="c1"># let&#39;s test this function</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.234567
</pre></div>
</div>
</div>
</div>
<p>Great!  It would be really convenient if we could just apply this to an entire column of the dataframe to produce a new column.  Let’s test this out in the cell below (uncomment the code and run the cell):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># netflix_df[&#39;megahours_viewed&#39;] = convert_bad_number(netflix_df[&#39;Hours Viewed&#39;])</span>
</pre></div>
</div>
</div>
</div>
<p>Oh nuts!  Well, maybe we should have expected that.</p>
<p>If the data were stored in something like a list, we would probably write a loop over the list to apply our function to the elements in succession.  This is possible with a dataframe but it is <em>incredibly</em> slow, so I’m not even going to show you how to do it.</p>
<p>One <strong>good</strong> way to apply a function to each element of a column in a dataframe is to use the <code class="docutils literal notranslate"><span class="pre">Dataframe.apply</span></code> function.  We’ll create the new column by <code class="docutils literal notranslate"><span class="pre">apply</span></code>-ing our function to the appropriate column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;Hours Viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">convert_bad_number</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arrested Development: Season 1</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>17,600,000</td>
      <td>17.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arrested Development: Season 3</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>7,000,000</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arrested Development: Season 2</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>11,300,000</td>
      <td>11.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Trailer Park Boys: Season 1</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,400,000</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trailer Park Boys: Season 2</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,800,000</td>
      <td>5.8</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trailer Park Boys: Season 4</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Trailer Park Boys: Season 3</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Trailer Park Boys: Season 5</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>8,400,000</td>
      <td>8.4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Trailer Park Boys: Season 7</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>7,500,000</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Trailer Park Boys: Season 6</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>4,800,000</td>
      <td>4.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hey, looking good!</p>
<p>I should mention quickly that, while this is a valid way to do this, it is usually not the computationally <em>quickest</em> way to do it.  But it’s fine for our purposes.</p>
</section>
<section id="apply-example-2">
<h4><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 2<a class="headerlink" href="#apply-example-2" title="Permalink to this heading">#</a></h4>
<p>The release date is also pretty interesting, but it’s a bit difficult to work with.  Let’s try to make a column that gives the number of days between the release date and the end of the viewing period (30 June 2023).  We’ll do the same type of thing that we did above: write a function and <code class="docutils literal notranslate"><span class="pre">apply</span></code> it to a column.</p>
<p>I’m going to use the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> module to speed things up.  If you haven’t worked with <code class="docutils literal notranslate"><span class="pre">datetime</span></code> before, that’s fine.  Read through the function and see if you can figure how it works.  Note that we have to build in a conditional for those titles that don’t have a release date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">calc_age</span><span class="p">(</span><span class="n">release_date</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">release_date</span><span class="p">):</span> <span class="c1"># if the release date is NaN</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">release_date</span> <span class="o">=</span> <span class="n">release_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="c1"># split the string</span>
        <span class="n">release_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">release_date</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">release_date</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">release_date</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="c1"># set the end date</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">release_date</span> <span class="c1"># calculate the difference between dates</span>
        <span class="k">return</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># add 1 so that we don&#39;t divide by zero later!</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s apply this function to the appropriate column in the dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;age_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;Release Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calc_age</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arrested Development: Season 1</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>17,600,000</td>
      <td>17.6</td>
      <td>4839.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arrested Development: Season 3</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>7,000,000</td>
      <td>7.0</td>
      <td>4839.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arrested Development: Season 2</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>11,300,000</td>
      <td>11.3</td>
      <td>4839.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Trailer Park Boys: Season 1</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,400,000</td>
      <td>5.4</td>
      <td>4665.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trailer Park Boys: Season 2</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,800,000</td>
      <td>5.8</td>
      <td>4665.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trailer Park Boys: Season 4</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Trailer Park Boys: Season 3</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Trailer Park Boys: Season 5</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>8,400,000</td>
      <td>8.4</td>
      <td>4665.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Trailer Park Boys: Season 7</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>7,500,000</td>
      <td>7.5</td>
      <td>4505.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Trailer Park Boys: Season 6</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>4,800,000</td>
      <td>4.8</td>
      <td>4505.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18204</th>
      <td>Špindl</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18205</th>
      <td>Żyć nie umierać</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18206</th>
      <td>الناموس: Season 1</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18207</th>
      <td>حكايات بنات الجزء ١: Season 2</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18208</th>
      <td>حكايات بنات الجزء ١: Season 3</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18209</th>
      <td>راس السنة</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18210</th>
      <td>心が叫びたがってるんだ。</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18211</th>
      <td>두근두근 내 인생</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18212</th>
      <td>라디오 스타</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18213</th>
      <td>선생 김봉두</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="apply-example-3">
<h4><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 3<a class="headerlink" href="#apply-example-3" title="Permalink to this heading">#</a></h4>
<p>Many of the titles appear to be series, or what old people like me call “TV shows”.  We may wish to know how many different “properties” there are in this dataset.  <em>I.e.</em>, a movie like <em>Lost in Translation</em> is a single artistic entity, whereas <em>Trailer Park Boys: Season 6</em> is simply another installment in an artistic entity.</p>
<p>Let’s write a function that grabs all of the stuff before the colon (“:”) in a title an puts it in a new column called <code class="docutils literal notranslate"><span class="pre">property</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">property</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">prop</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">prop</span>

<span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arrested Development: Season 1</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>17,600,000</td>
      <td>17.6</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arrested Development: Season 3</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>7,000,000</td>
      <td>7.0</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arrested Development: Season 2</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>11,300,000</td>
      <td>11.3</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Trailer Park Boys: Season 1</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,400,000</td>
      <td>5.4</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trailer Park Boys: Season 2</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,800,000</td>
      <td>5.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trailer Park Boys: Season 4</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Trailer Park Boys: Season 3</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Trailer Park Boys: Season 5</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>8,400,000</td>
      <td>8.4</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Trailer Park Boys: Season 7</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>7,500,000</td>
      <td>7.5</td>
      <td>4505.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Trailer Park Boys: Season 6</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>4,800,000</td>
      <td>4.8</td>
      <td>4505.0</td>
      <td>Trailer Park Boys</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Looks like it worked well enough!  Whether we can reliably interpret this new column is something that we’ll need to investigate later on.  For example, I’m not sure what to make of “Kevin Hart: What Now?”</p>
</section>
<section id="warm-up-problem-must-do-this">
<h4>Warm-up problem (must do this!)<a class="headerlink" href="#warm-up-problem-must-do-this" title="Permalink to this heading">#</a></h4>
<p>Below is a function that determines whether ‘Season’ or ‘Series’ appears in a string.  Write some code that applies this function to the titles in the dataframe to produce a new column called ‘series?’.  Later we’ll use this to approximate whether each title is more like a TV show or a movie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">season_in_title</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;Season&#39;</span> <span class="ow">in</span> <span class="n">t</span> <span class="ow">or</span> <span class="s1">&#39;Series&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### your code goes here</span>



<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arrested Development: Season 1</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>17,600,000</td>
      <td>17.6</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arrested Development: Season 3</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>7,000,000</td>
      <td>7.0</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arrested Development: Season 2</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>11,300,000</td>
      <td>11.3</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Trailer Park Boys: Season 1</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,400,000</td>
      <td>5.4</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trailer Park Boys: Season 2</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,800,000</td>
      <td>5.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trailer Park Boys: Season 4</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Trailer Park Boys: Season 3</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Trailer Park Boys: Season 5</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>8,400,000</td>
      <td>8.4</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Trailer Park Boys: Season 7</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>7,500,000</td>
      <td>7.5</td>
      <td>4505.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Trailer Park Boys: Season 6</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>4,800,000</td>
      <td>4.8</td>
      <td>4505.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>10</th>
      <td>La Reina del Sur: Season 1</td>
      <td>No</td>
      <td>2011-09-05</td>
      <td>94,700,000</td>
      <td>94.7</td>
      <td>4317.0</td>
      <td>La Reina del Sur</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Lilyhammer: Season 1</td>
      <td>No</td>
      <td>2012-02-06</td>
      <td>3,500,000</td>
      <td>3.5</td>
      <td>4163.0</td>
      <td>Lilyhammer</td>
    </tr>
    <tr>
      <th>12</th>
      <td>House of Cards: Season 1</td>
      <td>No</td>
      <td>2013-02-01</td>
      <td>20,000,000</td>
      <td>20.0</td>
      <td>3802.0</td>
      <td>House of Cards</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Black Mirror: Season 1</td>
      <td>No</td>
      <td>2013-02-28</td>
      <td>20,100,000</td>
      <td>20.1</td>
      <td>3775.0</td>
      <td>Black Mirror</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Longmire: Season 1</td>
      <td>No</td>
      <td>2013-05-15</td>
      <td>9,600,000</td>
      <td>9.6</td>
      <td>3699.0</td>
      <td>Longmire</td>
    </tr>
    <tr>
      <th>15</th>
      <td>The Fall: Season 1</td>
      <td>No</td>
      <td>2013-05-27</td>
      <td>6,600,000</td>
      <td>6.6</td>
      <td>3687.0</td>
      <td>The Fall</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Orange Is the New Black: Season 1</td>
      <td>Yes</td>
      <td>2013-07-11</td>
      <td>48,800,000</td>
      <td>48.8</td>
      <td>3642.0</td>
      <td>Orange Is the New Black</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Mako Mermaids: An H2O Adventure: Season 1</td>
      <td>No</td>
      <td>2013-07-26</td>
      <td>24,700,000</td>
      <td>24.7</td>
      <td>3627.0</td>
      <td>Mako Mermaids</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Rita: Season 1</td>
      <td>Yes</td>
      <td>2013-08-14</td>
      <td>2,400,000</td>
      <td>2.4</td>
      <td>3608.0</td>
      <td>Rita</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Derek: Season 1</td>
      <td>Yes</td>
      <td>2013-09-12</td>
      <td>900,000</td>
      <td>0.9</td>
      <td>3579.0</td>
      <td>Derek</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="warm-up-problem">
<h4>Warm-up problem<a class="headerlink" href="#warm-up-problem" title="Permalink to this heading">#</a></h4>
<p>Below is a function that counts the number of non-Roman characters in a string.  Write some code that applies this function to the titles in the dataframe to produce a new column called ‘non_roman_characters’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roman_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcdcefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890!.,;:?&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_non_roman_chars</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">non_roman_chars</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s_arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roman_chars</span><span class="p">:</span>
            <span class="n">non_roman_chars</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">non_roman_chars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### your code goes here</span>


<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arrested Development: Season 1</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>17,600,000</td>
      <td>17.6</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arrested Development: Season 3</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>7,000,000</td>
      <td>7.0</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arrested Development: Season 2</td>
      <td>No</td>
      <td>2010-04-01</td>
      <td>11,300,000</td>
      <td>11.3</td>
      <td>4839.0</td>
      <td>Arrested Development</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Trailer Park Boys: Season 1</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,400,000</td>
      <td>5.4</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trailer Park Boys: Season 2</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>5,800,000</td>
      <td>5.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trailer Park Boys: Season 4</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Trailer Park Boys: Season 3</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>6,800,000</td>
      <td>6.8</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Trailer Park Boys: Season 5</td>
      <td>Yes</td>
      <td>2010-09-22</td>
      <td>8,400,000</td>
      <td>8.4</td>
      <td>4665.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Trailer Park Boys: Season 7</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>7,500,000</td>
      <td>7.5</td>
      <td>4505.0</td>
      <td>Trailer Park Boys</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Trailer Park Boys: Season 6</td>
      <td>Yes</td>
      <td>2011-03-01</td>
      <td>4,800,000</td>
      <td>4.8</td>
      <td>4505.0</td>
      <td>Trailer Park Boys</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18204</th>
      <td>Špindl</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Špindl</td>
    </tr>
    <tr>
      <th>18205</th>
      <td>Żyć nie umierać</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Żyć nie umierać</td>
    </tr>
    <tr>
      <th>18206</th>
      <td>الناموس: Season 1</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>الناموس</td>
    </tr>
    <tr>
      <th>18207</th>
      <td>حكايات بنات الجزء ١: Season 2</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>حكايات بنات الجزء ١</td>
    </tr>
    <tr>
      <th>18208</th>
      <td>حكايات بنات الجزء ١: Season 3</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>حكايات بنات الجزء ١</td>
    </tr>
    <tr>
      <th>18209</th>
      <td>راس السنة</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>راس السنة</td>
    </tr>
    <tr>
      <th>18210</th>
      <td>心が叫びたがってるんだ。</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>心が叫びたがってるんだ。</td>
    </tr>
    <tr>
      <th>18211</th>
      <td>두근두근 내 인생</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>두근두근 내 인생</td>
    </tr>
    <tr>
      <th>18212</th>
      <td>라디오 스타</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>라디오 스타</td>
    </tr>
    <tr>
      <th>18213</th>
      <td>선생 김봉두</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>선생 김봉두</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id1">
<h4>Warm-up problem<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<p>Now you try!  Write a function, <code class="docutils literal notranslate"><span class="pre">bool_convert</span></code>, that takes a string as input and produces a 0 if the string is ‘No’ and a 1 if the string is ‘Yes’.  Apply this function to the “Available Globally?” column of the dataframe to produce a new column called “avail_globally_int”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### your code goes here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="re-ordering-the-dataset-sort-values">
<h2><span class="section-number">6.4. </span>Re-ordering the dataset –&gt; <code class="docutils literal notranslate"><span class="pre">sort_values</span></code><a class="headerlink" href="#re-ordering-the-dataset-sort-values" title="Permalink to this heading">#</a></h2>
<p>So far we’ve been taking glances at the dataframe by using the <code class="docutils literal notranslate"><span class="pre">head</span></code> and <code class="docutils literal notranslate"><span class="pre">tail</span></code> functions.  But the dataframe is ordered based on titles’ release dates, which isn’t super helpful for many of the research questions we established above.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Dataframe.sort_values</span></code> function can re-order the dataframe according to any column(s) that we provide.  For example, we can answer our first research question by doing the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netflix_df</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18213</th>
      <td>선생 김봉두</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>선생 김봉두</td>
    </tr>
    <tr>
      <th>3189</th>
      <td>Phil Wang: Philly Philly Wang Wang</td>
      <td>Yes</td>
      <td>2021-08-10</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>690.0</td>
      <td>Phil Wang</td>
    </tr>
    <tr>
      <th>16133</th>
      <td>Kamen Rider Zero-One // 仮面ライダーゼロワン</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kamen Rider Zero-One // 仮面ライダーゼロワン</td>
    </tr>
    <tr>
      <th>16132</th>
      <td>Kamen Rider Reiwa: The First Generation // 仮面ラ...</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kamen Rider Reiwa</td>
    </tr>
    <tr>
      <th>16131</th>
      <td>Kamen Rider Heisei Generations Forever // 平成仮面...</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kamen Rider Heisei Generations Forever // 平成仮面...</td>
    </tr>
    <tr>
      <th>16130</th>
      <td>Kameleon 2</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kameleon 2</td>
    </tr>
    <tr>
      <th>16129</th>
      <td>Kamalatho Naa Prayanam</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kamalatho Naa Prayanam</td>
    </tr>
    <tr>
      <th>16128</th>
      <td>Kalel, 15</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kalel, 15</td>
    </tr>
    <tr>
      <th>16127</th>
      <td>Kain Kafan Hitam</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kain Kafan Hitam</td>
    </tr>
    <tr>
      <th>16126</th>
      <td>Kaguya-sama: Love Is War (2019 Live Action) //...</td>
      <td>No</td>
      <td>NaN</td>
      <td>100,000</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>Kaguya-sama</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You’ll notice that it looks like <code class="docutils literal notranslate"><span class="pre">pandas</span></code> defaults to ascending order; it put the least-viewed titles at the top of the dataframe.  We can reverse this by setting the <code class="docutils literal notranslate"><span class="pre">ascending</span></code> keyword to <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netflix_df</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4670</th>
      <td>The Night Agent: Season 1</td>
      <td>Yes</td>
      <td>2023-03-23</td>
      <td>812,100,000</td>
      <td>812.1</td>
      <td>100.0</td>
      <td>The Night Agent</td>
    </tr>
    <tr>
      <th>4532</th>
      <td>Ginny &amp; Georgia: Season 2</td>
      <td>Yes</td>
      <td>2023-01-05</td>
      <td>665,100,000</td>
      <td>665.1</td>
      <td>177.0</td>
      <td>Ginny &amp; Georgia</td>
    </tr>
    <tr>
      <th>4517</th>
      <td>The Glory: Season 1 // 더 글로리: 시즌 1</td>
      <td>Yes</td>
      <td>2022-12-30</td>
      <td>622,800,000</td>
      <td>622.8</td>
      <td>183.0</td>
      <td>The Glory</td>
    </tr>
    <tr>
      <th>4405</th>
      <td>Wednesday: Season 1</td>
      <td>Yes</td>
      <td>2022-11-23</td>
      <td>507,700,000</td>
      <td>507.7</td>
      <td>220.0</td>
      <td>Wednesday</td>
    </tr>
    <tr>
      <th>4754</th>
      <td>Queen Charlotte: A Bridgerton Story</td>
      <td>Yes</td>
      <td>2023-05-04</td>
      <td>503,000,000</td>
      <td>503.0</td>
      <td>58.0</td>
      <td>Queen Charlotte</td>
    </tr>
    <tr>
      <th>4591</th>
      <td>You: Season 4</td>
      <td>Yes</td>
      <td>2023-02-09</td>
      <td>440,600,000</td>
      <td>440.6</td>
      <td>142.0</td>
      <td>You</td>
    </tr>
    <tr>
      <th>4519</th>
      <td>La Reina del Sur: Season 3</td>
      <td>No</td>
      <td>2022-12-30</td>
      <td>429,600,000</td>
      <td>429.6</td>
      <td>183.0</td>
      <td>La Reina del Sur</td>
    </tr>
    <tr>
      <th>4624</th>
      <td>Outer Banks: Season 3</td>
      <td>Yes</td>
      <td>2023-02-23</td>
      <td>402,500,000</td>
      <td>402.5</td>
      <td>128.0</td>
      <td>Outer Banks</td>
    </tr>
    <tr>
      <th>2856</th>
      <td>Ginny &amp; Georgia: Season 1</td>
      <td>Yes</td>
      <td>2021-02-24</td>
      <td>302,100,000</td>
      <td>302.1</td>
      <td>857.0</td>
      <td>Ginny &amp; Georgia</td>
    </tr>
    <tr>
      <th>4788</th>
      <td>FUBAR: Season 1</td>
      <td>Yes</td>
      <td>2023-05-25</td>
      <td>266,200,000</td>
      <td>266.2</td>
      <td>37.0</td>
      <td>FUBAR</td>
    </tr>
    <tr>
      <th>4349</th>
      <td>Manifest: Season 4</td>
      <td>Yes</td>
      <td>2022-11-04</td>
      <td>262,600,000</td>
      <td>262.6</td>
      <td>239.0</td>
      <td>Manifest</td>
    </tr>
    <tr>
      <th>4527</th>
      <td>Kaleidoscope: Limited Series</td>
      <td>Yes</td>
      <td>2023-01-01</td>
      <td>252,500,000</td>
      <td>252.5</td>
      <td>181.0</td>
      <td>Kaleidoscope</td>
    </tr>
    <tr>
      <th>4438</th>
      <td>Firefly Lane: Season 2</td>
      <td>Yes</td>
      <td>2022-12-02</td>
      <td>251,500,000</td>
      <td>251.5</td>
      <td>211.0</td>
      <td>Firefly Lane</td>
    </tr>
    <tr>
      <th>4764</th>
      <td>The Mother</td>
      <td>Yes</td>
      <td>2023-05-12</td>
      <td>249,900,000</td>
      <td>249.9</td>
      <td>50.0</td>
      <td>The Mother</td>
    </tr>
    <tr>
      <th>4566</th>
      <td>Physical: 100: Season 1 // 피지컬: 100: 시즌 1</td>
      <td>Yes</td>
      <td>2023-01-24</td>
      <td>235,000,000</td>
      <td>235.0</td>
      <td>158.0</td>
      <td>Physical</td>
    </tr>
    <tr>
      <th>4549</th>
      <td>Crash Course in Romance: Limited Series // 일타 ...</td>
      <td>Yes</td>
      <td>2023-01-14</td>
      <td>234,800,000</td>
      <td>234.8</td>
      <td>168.0</td>
      <td>Crash Course in Romance</td>
    </tr>
    <tr>
      <th>4676</th>
      <td>Love Is Blind: Season 4</td>
      <td>Yes</td>
      <td>2023-03-24</td>
      <td>229,700,000</td>
      <td>229.7</td>
      <td>99.0</td>
      <td>Love Is Blind</td>
    </tr>
    <tr>
      <th>4692</th>
      <td>BEEF: Season 1</td>
      <td>Yes</td>
      <td>2023-04-06</td>
      <td>221,100,000</td>
      <td>221.1</td>
      <td>86.0</td>
      <td>BEEF</td>
    </tr>
    <tr>
      <th>4725</th>
      <td>The Diplomat: Season 1</td>
      <td>Yes</td>
      <td>2023-04-20</td>
      <td>214,100,000</td>
      <td>214.1</td>
      <td>72.0</td>
      <td>The Diplomat</td>
    </tr>
    <tr>
      <th>4649</th>
      <td>Luther: The Fallen Sun</td>
      <td>Yes</td>
      <td>2023-03-10</td>
      <td>209,700,000</td>
      <td>209.7</td>
      <td>113.0</td>
      <td>Luther</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>So there’s the answer to our first question!  <em>The Night Agent</em> (which I am just now learning is a thing that exists) was the most-viewed show during this period.</p>
<p>Notice that the index column on the left still shows the original indices of the rows in the dataframe.  If we’re confident that we’d like to keep this new ordering of the dataframe, we can reset the indices thusly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">netflix_df</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>The Night Agent: Season 1</td>
      <td>Yes</td>
      <td>2023-03-23</td>
      <td>812,100,000</td>
      <td>812.1</td>
      <td>100.0</td>
      <td>The Night Agent</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ginny &amp; Georgia: Season 2</td>
      <td>Yes</td>
      <td>2023-01-05</td>
      <td>665,100,000</td>
      <td>665.1</td>
      <td>177.0</td>
      <td>Ginny &amp; Georgia</td>
    </tr>
    <tr>
      <th>2</th>
      <td>The Glory: Season 1 // 더 글로리: 시즌 1</td>
      <td>Yes</td>
      <td>2022-12-30</td>
      <td>622,800,000</td>
      <td>622.8</td>
      <td>183.0</td>
      <td>The Glory</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Wednesday: Season 1</td>
      <td>Yes</td>
      <td>2022-11-23</td>
      <td>507,700,000</td>
      <td>507.7</td>
      <td>220.0</td>
      <td>Wednesday</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Queen Charlotte: A Bridgerton Story</td>
      <td>Yes</td>
      <td>2023-05-04</td>
      <td>503,000,000</td>
      <td>503.0</td>
      <td>58.0</td>
      <td>Queen Charlotte</td>
    </tr>
    <tr>
      <th>5</th>
      <td>You: Season 4</td>
      <td>Yes</td>
      <td>2023-02-09</td>
      <td>440,600,000</td>
      <td>440.6</td>
      <td>142.0</td>
      <td>You</td>
    </tr>
    <tr>
      <th>6</th>
      <td>La Reina del Sur: Season 3</td>
      <td>No</td>
      <td>2022-12-30</td>
      <td>429,600,000</td>
      <td>429.6</td>
      <td>183.0</td>
      <td>La Reina del Sur</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Outer Banks: Season 3</td>
      <td>Yes</td>
      <td>2023-02-23</td>
      <td>402,500,000</td>
      <td>402.5</td>
      <td>128.0</td>
      <td>Outer Banks</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Ginny &amp; Georgia: Season 1</td>
      <td>Yes</td>
      <td>2021-02-24</td>
      <td>302,100,000</td>
      <td>302.1</td>
      <td>857.0</td>
      <td>Ginny &amp; Georgia</td>
    </tr>
    <tr>
      <th>9</th>
      <td>FUBAR: Season 1</td>
      <td>Yes</td>
      <td>2023-05-25</td>
      <td>266,200,000</td>
      <td>266.2</td>
      <td>37.0</td>
      <td>FUBAR</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Manifest: Season 4</td>
      <td>Yes</td>
      <td>2022-11-04</td>
      <td>262,600,000</td>
      <td>262.6</td>
      <td>239.0</td>
      <td>Manifest</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Kaleidoscope: Limited Series</td>
      <td>Yes</td>
      <td>2023-01-01</td>
      <td>252,500,000</td>
      <td>252.5</td>
      <td>181.0</td>
      <td>Kaleidoscope</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Firefly Lane: Season 2</td>
      <td>Yes</td>
      <td>2022-12-02</td>
      <td>251,500,000</td>
      <td>251.5</td>
      <td>211.0</td>
      <td>Firefly Lane</td>
    </tr>
    <tr>
      <th>13</th>
      <td>The Mother</td>
      <td>Yes</td>
      <td>2023-05-12</td>
      <td>249,900,000</td>
      <td>249.9</td>
      <td>50.0</td>
      <td>The Mother</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Physical: 100: Season 1 // 피지컬: 100: 시즌 1</td>
      <td>Yes</td>
      <td>2023-01-24</td>
      <td>235,000,000</td>
      <td>235.0</td>
      <td>158.0</td>
      <td>Physical</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Crash Course in Romance: Limited Series // 일타 ...</td>
      <td>Yes</td>
      <td>2023-01-14</td>
      <td>234,800,000</td>
      <td>234.8</td>
      <td>168.0</td>
      <td>Crash Course in Romance</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Love Is Blind: Season 4</td>
      <td>Yes</td>
      <td>2023-03-24</td>
      <td>229,700,000</td>
      <td>229.7</td>
      <td>99.0</td>
      <td>Love Is Blind</td>
    </tr>
    <tr>
      <th>17</th>
      <td>BEEF: Season 1</td>
      <td>Yes</td>
      <td>2023-04-06</td>
      <td>221,100,000</td>
      <td>221.1</td>
      <td>86.0</td>
      <td>BEEF</td>
    </tr>
    <tr>
      <th>18</th>
      <td>The Diplomat: Season 1</td>
      <td>Yes</td>
      <td>2023-04-20</td>
      <td>214,100,000</td>
      <td>214.1</td>
      <td>72.0</td>
      <td>The Diplomat</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Luther: The Fallen Sun</td>
      <td>Yes</td>
      <td>2023-03-10</td>
      <td>209,700,000</td>
      <td>209.7</td>
      <td>113.0</td>
      <td>Luther</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Congratulations, <em>The Night Agent</em> – you’re #0!</p>
<p>The majority of the top-twenty titles appear to be what we could consider to be shows/series!  This is maybe not surprising.</p>
<p><code class="docutils literal notranslate"><span class="pre">sort_values</span></code> also allows you to sort based on two features.  Say we want to sort based on the days since release and then by the number of hours viewed.  We supply <code class="docutils literal notranslate"><span class="pre">sort_values</span></code> with a list of column names.  I just want to show you this; I don’t want to actually change the dataframe.  See if you can parse the code below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">netflix_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;age_days&#39;</span><span class="p">,</span> <span class="s1">&#39;megahours_viewed&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Available Globally?</th>
      <th>Release Date</th>
      <th>Hours Viewed</th>
      <th>megahours_viewed</th>
      <th>age_days</th>
      <th>property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6209</th>
      <td>Nimona</td>
      <td>Yes</td>
      <td>2023-06-30</td>
      <td>1,800,000</td>
      <td>1.8</td>
      <td>1.0</td>
      <td>Nimona</td>
    </tr>
    <tr>
      <th>5168</th>
      <td>Celebrity: Limited Series // 셀러브리티: 리미티드 시리즈</td>
      <td>Yes</td>
      <td>2023-06-30</td>
      <td>2,600,000</td>
      <td>2.6</td>
      <td>1.0</td>
      <td>Celebrity</td>
    </tr>
    <tr>
      <th>4846</th>
      <td>Is It Cake, Too?</td>
      <td>Yes</td>
      <td>2023-06-30</td>
      <td>3,000,000</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>Is It Cake, Too?</td>
    </tr>
    <tr>
      <th>7385</th>
      <td>Ōoku: The Inner Chambers: Season 1 // 大奥: シーズン1</td>
      <td>No</td>
      <td>2023-06-29</td>
      <td>1,200,000</td>
      <td>1.2</td>
      <td>2.0</td>
      <td>Ōoku</td>
    </tr>
    <tr>
      <th>3455</th>
      <td>Lust Stories 2 // लस्ट स्टोरीज़ 2</td>
      <td>Yes</td>
      <td>2023-06-29</td>
      <td>5,200,000</td>
      <td>5.2</td>
      <td>2.0</td>
      <td>Lust Stories 2 // लस्ट स्टोरीज़ 2</td>
    </tr>
    <tr>
      <th>547</th>
      <td>The Witcher: Season 3</td>
      <td>Yes</td>
      <td>2023-06-29</td>
      <td>33,400,000</td>
      <td>33.4</td>
      <td>2.0</td>
      <td>The Witcher</td>
    </tr>
    <tr>
      <th>8246</th>
      <td>Eldorado: Everything the Nazis Hate</td>
      <td>Yes</td>
      <td>2023-06-28</td>
      <td>900,000</td>
      <td>0.9</td>
      <td>3.0</td>
      <td>Eldorado</td>
    </tr>
    <tr>
      <th>2976</th>
      <td>Muscles &amp; Mayhem: An Unauthorized Story of Ame...</td>
      <td>Yes</td>
      <td>2023-06-28</td>
      <td>6,300,000</td>
      <td>6.3</td>
      <td>3.0</td>
      <td>Muscles &amp; Mayhem</td>
    </tr>
    <tr>
      <th>2673</th>
      <td>Run Rabbit Run</td>
      <td>No</td>
      <td>2023-06-28</td>
      <td>7,300,000</td>
      <td>7.3</td>
      <td>3.0</td>
      <td>Run Rabbit Run</td>
    </tr>
    <tr>
      <th>2491</th>
      <td>DELETE: Season 1</td>
      <td>Yes</td>
      <td>2023-06-28</td>
      <td>8,000,000</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>DELETE</td>
    </tr>
    <tr>
      <th>1084</th>
      <td>Titans: Season 4</td>
      <td>No</td>
      <td>2023-06-25</td>
      <td>19,700,000</td>
      <td>19.7</td>
      <td>6.0</td>
      <td>Titans</td>
    </tr>
    <tr>
      <th>4288</th>
      <td>King of Clones // 킹 오브 클론 : 황우석 박사의 몰락</td>
      <td>Yes</td>
      <td>2023-06-23</td>
      <td>3,700,000</td>
      <td>3.7</td>
      <td>8.0</td>
      <td>King of Clones // 킹 오브 클론</td>
    </tr>
    <tr>
      <th>3014</th>
      <td>Pokémon Ultimate Journeys: The Series: Part 3</td>
      <td>No</td>
      <td>2023-06-23</td>
      <td>6,300,000</td>
      <td>6.3</td>
      <td>8.0</td>
      <td>Pokémon Ultimate Journeys</td>
    </tr>
    <tr>
      <th>1785</th>
      <td>iNumber Number: Jozi Gold</td>
      <td>Yes</td>
      <td>2023-06-23</td>
      <td>11,700,000</td>
      <td>11.7</td>
      <td>8.0</td>
      <td>iNumber Number</td>
    </tr>
    <tr>
      <th>1079</th>
      <td>Catching Killers: Season 3</td>
      <td>Yes</td>
      <td>2023-06-23</td>
      <td>19,800,000</td>
      <td>19.8</td>
      <td>8.0</td>
      <td>Catching Killers</td>
    </tr>
    <tr>
      <th>870</th>
      <td>Make Me Believe // Sen İnandır</td>
      <td>Yes</td>
      <td>2023-06-23</td>
      <td>24,000,000</td>
      <td>24.0</td>
      <td>8.0</td>
      <td>Make Me Believe // Sen İnandır</td>
    </tr>
    <tr>
      <th>817</th>
      <td>The Perfect Find</td>
      <td>Yes</td>
      <td>2023-06-23</td>
      <td>25,400,000</td>
      <td>25.4</td>
      <td>8.0</td>
      <td>The Perfect Find</td>
    </tr>
    <tr>
      <th>375</th>
      <td>Through My Window 2: Across the Sea // A travé...</td>
      <td>Yes</td>
      <td>2023-06-23</td>
      <td>42,900,000</td>
      <td>42.9</td>
      <td>8.0</td>
      <td>Through My Window 2</td>
    </tr>
    <tr>
      <th>2639</th>
      <td>Skull Island: Season 1</td>
      <td>Yes</td>
      <td>2023-06-22</td>
      <td>7,400,000</td>
      <td>7.4</td>
      <td>9.0</td>
      <td>Skull Island</td>
    </tr>
    <tr>
      <th>1778</th>
      <td>Let's Get Divorced: Season 1 // 離婚しようよ: シーズン1</td>
      <td>No</td>
      <td>2023-06-22</td>
      <td>11,700,000</td>
      <td>11.7</td>
      <td>9.0</td>
      <td>Let's Get Divorced</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<hr class="docutils" />
<section id="id2">
<h2><span class="section-number">6.5. </span>Data reduction<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>OK, it feels like we’re getting a handle on what’s in this dataset.  We can now try to <em>reduce</em> it, to boil its contents down to gain some higher-level understanding.</p>
<p>Note that we can generate summary statistics for the entire dataset using basic <code class="docutils literal notranslate"><span class="pre">pandas</span></code> functions on the individual columns.  These summary statistics reduce the data <em>all the way down</em> to a small set of values.</p>
<p>Before you continue, please interpret the results of each of the following lines of code (<em>i.e.</em>, talk with the person sitting next to you about what each of the output values means).  You’ll may have to Google the last one; that’s ok.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- - - - -&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>812.1
93455.2
0.7
5.130954211046448
18.71767223616126
- - - - -
0.25      0.2
0.50      0.7
0.75      3.4
1.00    812.1
Name: megahours_viewed, dtype: float64
</pre></div>
</div>
</div>
</div>
<section id="groupby">
<h3><code class="docutils literal notranslate"><span class="pre">groupby</span></code><a class="headerlink" href="#groupby" title="Permalink to this heading">#</a></h3>
<p>If you’re a data science exec at Neflix, a lot of your job is probably helping the company to determine what to make and market next to ~~increase viewership or subsciptions~~ investigate the human condition.  Said simply: What do the people want?  (Or what can you convince them that they want?)  The summary statistics above are not sufficient to answer this question because in calculating them, we’ve reduced out all of the information about any groups of titles.</p>
<p>Luckily, the <code class="docutils literal notranslate"><span class="pre">Dataframe.groupby</span></code> function in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> can  do what we want!</p>
<p>Let’s first look at the properties that are series.  These seem to do well.  I’ll create a dataset that includes only those titles that have a 1 for the <code class="docutils literal notranslate"><span class="pre">series?</span></code> feature.  Note that if you didn’t complete the first warm-up problem, the cell below <strong>will not work!</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series_df</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;series?&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">series_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">File ~/opt/miniconda3/envs/snakes/lib/python3.11/site-packages/pandas/core/indexes/base.py:3652,</span> in <span class="ni">Index.get_loc</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">   </span><span class="mi">3651</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3652</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">casted_key</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3653</span> <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

<span class="nn">File ~/opt/miniconda3/envs/snakes/lib/python3.11/site-packages/pandas/_libs/index.pyx:147,</span> in <span class="ni">pandas._libs.index.IndexEngine.get_loc</span><span class="nt">()</span>

<span class="nn">File ~/opt/miniconda3/envs/snakes/lib/python3.11/site-packages/pandas/_libs/index.pyx:176,</span> in <span class="ni">pandas._libs.index.IndexEngine.get_loc</span><span class="nt">()</span>

<span class="nn">File pandas/_libs/hashtable_class_helper.pxi:7080,</span> in <span class="ni">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="nt">()</span>

<span class="nn">File pandas/_libs/hashtable_class_helper.pxi:7088,</span> in <span class="ni">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="nt">()</span>

<span class="ne">KeyError</span>: &#39;series?&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">series_df</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;series?&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">display</span><span class="p">(</span><span class="n">series_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="nn">File ~/opt/miniconda3/envs/snakes/lib/python3.11/site-packages/pandas/core/frame.py:3761,</span> in <span class="ni">DataFrame.__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">   </span><span class="mi">3759</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3760</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem_multilevel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3761</span> <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3762</span> <span class="k">if</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">indexer</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">3763</span>     <span class="n">indexer</span> <span class="o">=</span> <span class="p">[</span><span class="n">indexer</span><span class="p">]</span>

<span class="nn">File ~/opt/miniconda3/envs/snakes/lib/python3.11/site-packages/pandas/core/indexes/base.py:3654,</span> in <span class="ni">Index.get_loc</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">   </span><span class="mi">3652</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">casted_key</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3653</span> <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3654</span>     <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
<span class="g g-Whitespace">   </span><span class="mi">3655</span> <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3656</span>     <span class="c1"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="g g-Whitespace">   </span><span class="mi">3657</span>     <span class="c1">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="g g-Whitespace">   </span><span class="mi">3658</span>     <span class="c1">#  the TypeError.</span>
<span class="g g-Whitespace">   </span><span class="mi">3659</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_check_indexing_error</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="ne">KeyError</span>: &#39;series?&#39;
</pre></div>
</div>
</div>
</div>
<p>Now let’s use <code class="docutils literal notranslate"><span class="pre">groupby</span></code> to group titles that are of the same property.  In general, <code class="docutils literal notranslate"><span class="pre">groupby</span></code> combine all of the rows in a dataframe that have the same value for the column(s) that you specify.  For example, doing a <code class="docutils literal notranslate"><span class="pre">groupby</span></code> on <code class="docutils literal notranslate"><span class="pre">property</span></code> will group all of the seasons of <em>The Unbreakable Kimmy Schmidt</em> together as a single entry (and similar for other properties).</p>
<p>When we group entries in this way, there will be some information that we want to keep and some that we will discard.  For example, we almost certainly want to keep the hours watched information (to either sum or average), but we will likely discard the release dates since there isn’t a sensible way to combine the multiple release dates for the different seasons of a show.</p>
<p>We have have to tell <code class="docutils literal notranslate"><span class="pre">pandas</span></code> which information to keep (<em>i.e.</em>, <code class="docutils literal notranslate"><span class="pre">megahours_viewed</span></code>) and how we want to combine it for the various entries.  Let’s start by simply adding all of the <code class="docutils literal notranslate"><span class="pre">megahours_viewed</span></code> for the entries that we group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series_df_0</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;series?&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">series_df_0</span> <span class="o">=</span> <span class="n">series_df_0</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">)[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">series_df_0</span> <span class="o">=</span> <span class="n">series_df_0</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">series_df_0</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll count number of titles that are grouped to each property:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series_df_1</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;series?&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">series_df_1</span> <span class="o">=</span> <span class="n">series_df_1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">)[</span><span class="s1">&#39;Title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">series_df_1</span> <span class="o">=</span> <span class="n">series_df_1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">series_df_1</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>… which confirms my suspicion that <em>Grey’s Anatomy</em> has been on for tooooooo loooooooong.</p>
<p>This looks good so far, but it’s also inefficient.  What if I wanted to both count the seasons <em>and</em> sum the hours viewed?  I don’t want to have to carry two separate dataframes around.</p>
</section>
<section id="agg">
<h3><code class="docutils literal notranslate"><span class="pre">agg</span></code><a class="headerlink" href="#agg" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Dataframe.agg</span></code> function allows us to give multiple reduction instructions to <code class="docutils literal notranslate"><span class="pre">groupby</span></code>.  <code class="docutils literal notranslate"><span class="pre">agg</span></code> is short for</p>
<blockquote>
<div><p><strong>aggregate</strong> (/ˈaɡ rə ɡət/) <em>adj.</em>, formed or calculated by the combination of many separate units or items</p>
</div></blockquote>
<p>With <code class="docutils literal notranslate"><span class="pre">agg</span></code>, we supply a <strong>dictionary</strong> (you remember those, right?) of feature/function pairs.  For exmaple, I can do both of the reductions above with the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series_df</span> <span class="o">=</span> <span class="n">netflix_df</span><span class="p">[</span><span class="n">netflix_df</span><span class="p">[</span><span class="s1">&#39;series?&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">agg_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Title&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;megahours_viewed&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">}</span>

<span class="n">series_df</span> <span class="o">=</span> <span class="n">series_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">series_df</span> <span class="o">=</span> <span class="n">series_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">series_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>One weirdness of <code class="docutils literal notranslate"><span class="pre">agg</span></code> is that we supply <em>strings</em> of the function names!  So in the above the function named <code class="docutils literal notranslate"><span class="pre">'sum'</span></code> gets applied to the <code class="docutils literal notranslate"><span class="pre">'megahours_viewed'</span></code> column, and <code class="docutils literal notranslate"><span class="pre">count</span></code> counts the unique entries in the <code class="docutils literal notranslate"><span class="pre">Title</span></code> column.</p>
<p>Check out what we can now do with this reduced dataset!  We’ll rename one of the columns and then calculate the average viewership per season:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series_df</span> <span class="o">=</span> <span class="n">series_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Title&#39;</span><span class="p">:</span> <span class="s1">&#39;n_seasons&#39;</span><span class="p">})</span>

<span class="n">series_df</span><span class="p">[</span><span class="s1">&#39;Mhv_per_season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_df</span><span class="p">[</span><span class="s1">&#39;megahours_viewed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">series_df</span><span class="p">[</span><span class="s1">&#39;n_seasons&#39;</span><span class="p">]</span>

<span class="n">display</span><span class="p">(</span><span class="n">series_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Mhv_per_season&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Wow, <em>The Night Agent</em> (which is totally a thing that I knew about for several notebook cells now) wins again!</p>
</section>
</section>
<hr class="docutils" />
<section id="what-about-science-though">
<h2><span class="section-number">6.6. </span>What about science, though?<a class="headerlink" href="#what-about-science-though" title="Permalink to this heading">#</a></h2>
<p>I know what you’re thinking: the above examples with Netflix data were really, really, really great, but I’m trying to be a scientist over here!  How can these skills help me do science?</p>
<p>Let’s turn our attention to a large (but not nearly the whole thing) dataset from the <a class="reference external" href="https://en.wikipedia.org/wiki/Sloan_Digital_Sky_Survey">Sloan Digital Sky Survey</a> (SDSS).  Please click that link to read through the SDSS Wikipedia entry – it is an amazing instrument that has led to some excellent science!  The Tl;dr is that SDSS is a telescope in New Mexico that has taken spectra of over <span class="math notranslate nohighlight">\(10^6\)</span> astronomical objects (stars, galaxies, quasars).  You’re now going to analyze some of that data!</p>
<p>A quick aside about how we got the data you’re about to analyze.  SDSS makes all of its data available to the public.  Because the data is so voluminous (many, many objects) and complicated (position information, spectra, optical images) there is a sophisticated (SQL) web interface called SkyServer that is used to select and download subsets of the data.  You can find SkyServer <a class="reference external" href="https://skyserver.sdss.org/dr16/en/tools/search/sql.aspx">here</a>. The SQL codee that I used to generate the dataset below is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">TOP</span> <span class="mi">100000</span>
   <span class="n">s</span><span class="o">.</span><span class="n">specobjid</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">z</span> <span class="k">as</span> <span class="n">redshift</span><span class="p">,</span>
   <span class="n">s</span><span class="o">.</span><span class="n">plate</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">mjd</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">fiberid</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span>
   <span class="n">s</span><span class="o">.</span><span class="n">fiberid</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">zErr</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">zWarning</span><span class="p">,</span>
   <span class="n">s</span><span class="o">.</span><span class="n">subClass</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">velDisp</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">velDispErr</span><span class="p">,</span>
   <span class="n">s</span><span class="o">.</span><span class="n">spectroFlux_u</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">spectroFlux_g</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">spectroFlux_r</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">spectroFlux_i</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">spectroFlux_z</span><span class="p">,</span>
   <span class="n">s</span><span class="o">.</span><span class="n">elodieObject</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">elodieSpType</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">elodieBV</span>
<span class="n">FROM</span> <span class="n">SpecObj</span> <span class="k">as</span> <span class="n">s</span>
</pre></div>
</div>
<p>You do <strong>not</strong> need to know any of this, but I’m including it here for completeness.</p>
<p>Another quick aside just to brag.  I (Mike McCracken) have several SDSS spectrometer plates in my office!  Stop by to see them!</p>
<p>You’ll find the resulting data file in <code class="docutils literal notranslate"><span class="pre">data_files/</span></code> (duh).  This is the real stuff, people!  Let’s check it out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_files/SDSS_Skyserver_SQL1_2_2024_100kObjs_SpecObj.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sdss_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sdss_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">sdss_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Wow!  So this dataset contains a 22 features for <span class="math notranslate nohighlight">\(1\times10^5\)</span> astronomical objects studied by SDSS!  (Note: You can use SkyServer to generate a file with up to <span class="math notranslate nohighlight">\(5\times 10^5\)</span> objects if you’re feeling frisky.)</p>
<p>For now we’re going to focus on only a few of the features:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">specobjid</span></code> is a unique numerical identifier for each object in the dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code> is a string that tells us the basic type of the object (star, galaxy, QSO).  You should Google what a ‘QSO’ is.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subClass</span></code> is a string that gives us some more information about what the object is.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redshift</span></code> is a measure of the amount by which the light in the spectrum from that object is redshifted. This quantity is given the symbol <span class="math notranslate nohighlight">\(z\)</span> in astronomy.  More below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zErr</span></code> is the uncertainty in the measured redshift for the object.</p></li>
</ul>
<section id="astronomy-crash-course-from-a-particle-physicist">
<h3>Astronomy crash-course (from a particle physicist)<a class="headerlink" href="#astronomy-crash-course-from-a-particle-physicist" title="Permalink to this heading">#</a></h3>
<p>Here’s a really basic idea of how this data was collected.  Scientists point SDSS at a particular object in the sky.  They collect a spectrum of the light that the object emits.  Based on the features of the spectrum, they determine the class and subclass of the object.</p>
<p><em>Redshift</em> is a quantity that is essential to astronomy.  The basics are the following.  Special relativity tells us that the light emitted by an object moving away from an observer will will be shifted to longer wavelengths.  For example, stars emit light at all wavelengths in the visible spectrum.  The light from a star moving away from us will be shifted to longer wavelengths.  Red is on the long-wavelength end of the visible spectrum, so we call this shifting ‘redshift’.  One can determine the redshift of, say, a star through the following process:</p>
<ol class="arabic simple">
<li><p>Choose a known process that is likely to happen in the star.  A good choice would be something like one of the balmer-series transitions in hydrogen.</p></li>
<li><p>Measure the wavelength of this transition in a laboratory on Earth.  For example, the <span class="math notranslate nohighlight">\(n=4\)</span> to <span class="math notranslate nohighlight">\(n=2\)</span> transition in hydrogen produces a photon with wavelength <span class="math notranslate nohighlight">\(\lambda_{emit} = 486.135\textrm{ nm}\)</span>.</p></li>
<li><p>Measure the wavelength of the corresponding feature in the <em>observed</em> spectrum from the star (likely by fitting).  Call this value <span class="math notranslate nohighlight">\(\lambda_{obs}\)</span>.</p></li>
<li><p>Calculate the redshift as <span class="math notranslate nohighlight">\(z = (\lambda_{obs} - \lambda_{emit})/\lambda_{emit}\)</span>.</p></li>
</ol>
<p>The larger the redshift (<span class="math notranslate nohighlight">\(z\)</span>), the more difference there is between the emitted and observed wavelengths.  The larger the difference between the wavelengths, the faster the object is receding (moving away) from us (the observer).</p>
</section>
<section id="mean-z-values-for-different-classes-of-objects">
<h3>Mean <span class="math notranslate nohighlight">\(z\)</span> values for different classes of objects<a class="headerlink" href="#mean-z-values-for-different-classes-of-objects" title="Permalink to this heading">#</a></h3>
<p>Let’s do some grouping of this data to see if we can determine any significant differences in redshift between the different types of object.</p>
<p>To do this, I want to show off another way to give instructions to the <code class="docutils literal notranslate"><span class="pre">agg</span></code> function.  See if you can follow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_files/SDSS_Skyserver_SQL1_2_2024_100kObjs_SpecObj.csv&#39;</span><span class="p">)</span>

<span class="n">sdss_df</span> <span class="o">=</span> <span class="n">sdss_df</span><span class="p">[</span><span class="n">sdss_df</span><span class="p">[</span><span class="s1">&#39;zWarning&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># this removes objects with some suspicious features</span>

<span class="k">def</span> <span class="nf">negative_z</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="n">sdss_df</span><span class="p">[</span><span class="s1">&#39;negative_redshift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdss_df</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">negative_z</span><span class="p">)</span>

<span class="n">sdss_df</span> <span class="o">=</span> <span class="n">sdss_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;class&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">n_objects</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;specobjid&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_std</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_min</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_max</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span>
                                         <span class="n">n_negative_redshift</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;negative_redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                                         <span class="n">zErr_mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;zErr&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">sdss_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;redshift_mean&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="it-s-science-time">
<h3>It’s science time!<a class="headerlink" href="#it-s-science-time" title="Permalink to this heading">#</a></h3>
<p>We see very different values for the redshifts of stars, galaxies, and quasars (oops, I told you what ‘QSO’ means).  Below are a few questions that we can investigate with this reduced data.  You should answer at least the first two (talk with your neighbors) before you move on.</p>
<ol class="arabic simple">
<li><p>(Regular) Why is the mean redshift for most stars negative?  What does this mean about stars’ motion relative to us?  Why would this number on average be negative (that is, what’s the physical reason for this)?</p></li>
<li><p>(Semi-meanie) Nearly all 66.8 thousand of the galaxies in the dataset have positive <span class="math notranslate nohighlight">\(z\)</span>, meaning that they are moving away from us.  Why?  If you can’t figure this out, don’t feel bad – Einsten (yes, that Einstein) <a class="reference external" href="https://bigthink.com/13-8/lemaitre-priest-proved-einstein-wrong/">couldn’t either</a>.</p></li>
<li><p>(Meanie) By now you should have Googled what a quasar (‘QSO’) is.  Why do we only observe them with large redshifts?  Here’s a hint: For the largest-<span class="math notranslate nohighlight">\(z\)</span> quasar in the dataset (<span class="math notranslate nohighlight">\(z = 6.99\)</span>), the ‘lookback time’ is approximately <span class="math notranslate nohighlight">\(13.0\)</span> billion years.  (I’m not going to tell you what those words mean.)</p></li>
</ol>
<p>You may choose to work with this dataset more in the homework, but for now I’ll simply point out that each of the object classes contains a number of subclasses, for a total of 52 subclasses!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_files/SDSS_Skyserver_SQL1_2_2024_100kObjs_SpecObj.csv&#39;</span><span class="p">)</span>
<span class="n">sdss_df</span> <span class="o">=</span> <span class="n">sdss_df</span><span class="p">[</span><span class="n">sdss_df</span><span class="p">[</span><span class="s1">&#39;zWarning&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">sdss_df</span> <span class="o">=</span> <span class="n">sdss_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;subClass&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">n_objects</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;specobjid&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_std</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_min</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span>
                                         <span class="n">redshift_max</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span>
                                         <span class="n">zErr_mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;zErr&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">sdss_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;redshift_mean&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sdss_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="in-summary">
<h2><span class="section-number">6.7. </span>In summary<a class="headerlink" href="#in-summary" title="Permalink to this heading">#</a></h2>
<p>Perhaps you’re an Excel expert (Chem majors, are you with me?) and during the previous lesson on <code class="docutils literal notranslate"><span class="pre">pandas</span></code> basics you thought that this approach is just too much work get you to move away from a pointy-clicky spreadsheet program.
Today’s lesson should convince you that there are some (important) ways of working with data that Excel is just not suited for.  The aggregation of the SDSS data above would have taken approximately 13.0 billion years to do in Excel, and that’s assuming that Excel didn’t crash when you tried to open a csv file that big (and that you paid for Excel in the first place).</p>
<p>The tools that we’ve investigated above allow us to ask and answer new types of questions with data!  Hopefully they encourage you to think about science in a different way.</p>
</section>
<hr class="docutils" />
<section id="problems">
<h2><span class="section-number">6.8. </span>Problems<a class="headerlink" href="#problems" title="Permalink to this heading">#</a></h2>
<p>Your homework is to complete either (three of the numbered problems) or (the single Meanie).</p>
<section id="regulars">
<h3>Regulars<a class="headerlink" href="#regulars" title="Permalink to this heading">#</a></h3>
<section id="problem-1">
<h4>Problem 1<a class="headerlink" href="#problem-1" title="Permalink to this heading">#</a></h4>
<p>Using the Netlfix dataset, determine the titles with top-ten highest ‘freshness’.  ‘freshness’ is defined (by me) as the hours watched divided by the ‘age’ of the show in days.</p>
</section>
<section id="problem-2">
<h4>Problem 2<a class="headerlink" href="#problem-2" title="Permalink to this heading">#</a></h4>
<p>The Netflix dataset gives the hours watched during the first half of 2023.  Find the top-ten most-watched (duirng this period) titles that were not released during this period.</p>
</section>
<section id="problem-3">
<h4>Problem 3<a class="headerlink" href="#problem-3" title="Permalink to this heading">#</a></h4>
<p>What fraction of Netlfix titles are available globally?  Is there is a significant difference between viewership of globally available and non-globally available titles?</p>
</section>
<section id="problem-4">
<h4>Problem 4<a class="headerlink" href="#problem-4" title="Permalink to this heading">#</a></h4>
<p>You’re a data scientist at Netflix.  Your boss tells you that they want to remove the quartile (25%) of titles that have the lowest viewership during this period – it’s just not worth the cost of hosting these titles!  Generate a list of these titles and write it to text file.</p>
</section>
</section>
<section id="semi-meanies">
<h3>Semi-meanies<a class="headerlink" href="#semi-meanies" title="Permalink to this heading">#</a></h3>
<section id="problem-5">
<h4>Problem 5<a class="headerlink" href="#problem-5" title="Permalink to this heading">#</a></h4>
<p>Netflix dataset: Write a function that calulcates the ratio of non-Roman characters to total number of characters in a title, rounding this value to the nearest 0.01.  Apply it to the subset of the Netflix dataset that contains only series (<em>i.e.</em>, exclude movies), calling the new column <code class="docutils literal notranslate"><span class="pre">nr_ratio</span></code>.  Find the top-ten most-watched titles with <code class="docutils literal notranslate"><span class="pre">nr_ratio</span> <span class="pre">&gt;</span> <span class="pre">0.20</span></code>.</p>
</section>
<section id="problem-6">
<h4>Problem 6<a class="headerlink" href="#problem-6" title="Permalink to this heading">#</a></h4>
<p>SDSS dataset: The basic spectrographic information in the SDSS dataset can actually tell us something about the masses of the galaxies therein.  That’s crazy!  The <code class="docutils literal notranslate"><span class="pre">velDisp</span></code> feature in the data is a measure of distribution of velocities of the objects (stars) in a galaxy.  A larger <code class="docutils literal notranslate"><span class="pre">velDisp</span></code> (often given the symbol <span class="math notranslate nohighlight">\(\sigma\)</span>) means that there is a larger difference between the velocities of fastest and slowest objects.  This is actually an indirect measure of the mass of a galaxy (for complicated reasons).  Make a scatter plot of <code class="docutils literal notranslate"><span class="pre">velDisp</span></code> <em>vs</em> <code class="docutils literal notranslate"><span class="pre">redshift</span></code> (commonly called <span class="math notranslate nohighlight">\(\sigma\)</span> <em>vs</em> <span class="math notranslate nohighlight">\(z\)</span>) for all of the non-broadband galaxies in the dataset.  Color each datapoint according to its subclass (don’t forget a legend).  Keep in mind that (because of cosmological expansion) <code class="docutils literal notranslate"><span class="pre">redshift</span></code> is a measure of how far away an object is.  What relationship do you observe between these quantities?</p>
</section>
</section>
<section id="meanie-1-netflix-economist">
<h3>Meanie 1 – Netflix Economist<a class="headerlink" href="#meanie-1-netflix-economist" title="Permalink to this heading">#</a></h3>
<p>The quantiles information for the Netflix data suggests that the megahours watched is unevenly distributed among titles.  A small number of titles get watched a LOT (<em>Let’s Get Divorced: Season 1</em>???) and others barely at all.  We can investigate this by calculating the <a class="reference external" href="https://en.wikipedia.org/wiki/Gini_coefficient"><em>Gini coefficient</em></a> for the data.  (Note: This is a very common practice among macroeconomists who study inequality in many different systems!  Gini coefficient is a nice, general tool!)
Follow these steps to get your Gini coefficient.</p>
<ul class="simple">
<li><p>Create a dataframe that includes all non-series titles.  That is, omit any entry that has ‘series’ or ‘season’ in its title.  There are several ways to do this; you’re welcome to steal from the examples above.  How many titles are in this dataframe?</p></li>
<li><p>Create a new column that is <code class="docutils literal notranslate"><span class="pre">megahours_viewed</span></code> as we did in the examples above.</p></li>
<li><p>Determine the maximum <code class="docutils literal notranslate"><span class="pre">megahours_viewed</span></code> for the titles in the dataframe.  Call this value <span class="math notranslate nohighlight">\(v_{max}\)</span>.</p></li>
<li><p>Create a new column, <code class="docutils literal notranslate"><span class="pre">Mhv_ratio</span></code> that is each title’s <code class="docutils literal notranslate"><span class="pre">megahours_viewed</span></code> divided by <span class="math notranslate nohighlight">\(v_{max}\)</span>.  Note that the maximum value of <code class="docutils literal notranslate"><span class="pre">Mhv_ratio</span></code> should be 1 and the minimum value should be close to zero.</p></li>
<li><p>Make a histogram of <code class="docutils literal notranslate"><span class="pre">Mhv_ratio</span></code>.  Your histogram should have at least 100 bins and you should manually set the range on the horizontal axis to be 0 to 1.  Before you proceed to the next step, think carefully about what this histogram tells you.</p></li>
<li><p>Now you want to scale your histogram so that the height of the tallest bar is 1.  Said another way, you want to divide the height of each bar by the height of the tallest bar.  Think back to our fitting lessons.  When you use <code class="docutils literal notranslate"><span class="pre">pyplot</span></code> to make a histogram, it outputs information about the bin edges and bar heights.  For example, you can get this information from a bit of code like</p></li>
</ul>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">_</span> <span class="pre">=</span> <span class="pre">plt.hist(mhv_ratio_array)</span></code></p>
</div></blockquote>
<ul class="simple">
<li><p>To this scaled histogram, add a straight line that connects the points <span class="math notranslate nohighlight">\((0,0)\)</span> and <span class="math notranslate nohighlight">\((1,1)\)</span>.  Calculate the area under this line.  Call it <span class="math notranslate nohighlight">\(L\)</span>.  (Hint: It’s a traingle.)</p></li>
<li><p>Calculate the total area of all of the bars of your scaled histogram.  Call it <span class="math notranslate nohighlight">\(H\)</span>.  (Hint: Riemann sum.)</p></li>
<li><p>Calculate the Gini coefficient: <span class="math notranslate nohighlight">\(G = (L-H)/L\)</span>.</p></li>
<li><p>Do some googling to interpret the <span class="math notranslate nohighlight">\(G\)</span> vaule you get.  Is it large compared to, say, inequalities in income, wealth, education, <em>etc.</em>?</p></li>
<li><p>Congrats!  You’re now an economist.  (Not really.)</p></li>
</ul>
</section>
<section id="meanie-2-star-sleuth">
<h3>Meanie 2 – Star Sleuth<a class="headerlink" href="#meanie-2-star-sleuth" title="Permalink to this heading">#</a></h3>
<p>In this problem you will investigate the subclasses of stars in the SDSS dataset.  Astronomers classify stars using the Morgan–Keenan (MK) system, in which each star falls into one of seven classes (called O, B, A, F, G, K, and M) according to its temperature.  A star’s temperature is a function of the physics going on in it, so this is a useful classification scheme.  Check out the <a class="reference external" href="https://en.wikipedia.org/wiki/Stellar_classification">Wikipedia article</a> for more info, most importantly</p>
<blockquote>
<div><p>Most stars are currently classified under the Morgan–Keenan (MK) system using the letters O, B, A, F, G, K, and M, a sequence from the hottest (O type) to the coolest (M type). Each letter class is then subdivided using a numeric digit with 0 being hottest and 9 being coolest (e.g., A8, A9, F0, and F1 form a sequence from hotter to cooler).</p>
</div></blockquote>
<p>Let’s see if the quantitative data we have contains information that correlates with the star classes (or whether the star classification was done by some other means).</p>
<ul class="simple">
<li><p>First, create a dataframe that contains only objects with STAR class and a subclass from the MK scheme described above.  For example, you’ll need to omit subclasses such as ‘M0V’, ‘L5.5’, ‘A0p’, ‘OB’, ‘WD’, ‘Carbon’, <em>etc.</em></p></li>
<li><p>Create a new column in the dataframe called <code class="docutils literal notranslate"><span class="pre">MK_letter</span></code> which is just the first letter of the <code class="docutils literal notranslate"><span class="pre">subClass</span></code>.</p></li>
<li><p>We can’t directly determine the temperature of a star from our data, but the <code class="docutils literal notranslate"><span class="pre">spectroFlux_</span></code> features allow us indirect access.  Very simply the <code class="docutils literal notranslate"><span class="pre">spectroFlux_</span></code> features tell us how much light came from the object in particular parts of the spectrum.  For example, the <code class="docutils literal notranslate"><span class="pre">spectroFlux_r</span></code> quantity is a measure of how much of the object’s light passes through SDSS’s <strong>red</strong> filter.  By comparing several sepctroFluxes we can get an idea of the star’s temperature.  (Much more information on this process is available <a class="reference external" href="https://skyserver.sdss.org/dr1/en/proj/advanced/color/sdssfilters.asp">here</a> and on subsequent pages.)  Let’s give each of these <code class="docutils literal notranslate"><span class="pre">spectroFlux_</span></code> quantities symbols like <span class="math notranslate nohighlight">\(F_g\)</span>, <span class="math notranslate nohighlight">\(F_r\)</span>, <span class="math notranslate nohighlight">\(F_u\)</span>, <em>etc.</em>  For each star in the dataframe, calculate the following relative flux differences:
$<span class="math notranslate nohighlight">\(
  f_{ug} = (F_u - F_g) / F_g
\)</span><span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\(
  f_{gr} = (F_g - F_r) / F_r \\    
\)</span>$</p></li>
<li><p>Make a scatter plot of the <span class="math notranslate nohighlight">\(f_{ug}\)</span> <em>vs</em> <span class="math notranslate nohighlight">\(f_{gr}\)</span> for all of the stars in your dataframe.  Color each point according the its <code class="docutils literal notranslate"><span class="pre">MK_letter</span></code>.  Don’t forget to include a legend!  You will want to make your data points slightly transparent so that you can see them well.</p></li>
<li><p>Knowing what you know about the MK classification (<em>i.e.</em>, the temperature ordering of the classes) do you see a correlation between the relative flux differences and temperature?</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "executablebooks/jupyter-book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters_ipynb"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="scicomp_09_pandas.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Manipulating tabular data with <code class="docutils literal notranslate"><span class="pre">Pandas</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="scicomp_06_textasdata.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Text as data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">6.1. Recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">6.2. Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-reduction">6.3. Data reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#netflix-data">Netflix data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-do-we-want-to-know">What do we want to know?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apply"><code class="docutils literal notranslate"><span class="pre">apply</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-example-1"><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-example-2"><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-example-3"><code class="docutils literal notranslate"><span class="pre">apply</span></code> example 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#warm-up-problem-must-do-this">Warm-up problem (must do this!)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#warm-up-problem">Warm-up problem</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Warm-up problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-ordering-the-dataset-sort-values">6.4. Re-ordering the dataset –&gt; <code class="docutils literal notranslate"><span class="pre">sort_values</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">6.5. Data reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#groupby"><code class="docutils literal notranslate"><span class="pre">groupby</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#agg"><code class="docutils literal notranslate"><span class="pre">agg</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-about-science-though">6.6. What about science, though?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#astronomy-crash-course-from-a-particle-physicist">Astronomy crash-course (from a particle physicist)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-z-values-for-different-classes-of-objects">Mean <span class="math notranslate nohighlight">\(z\)</span> values for different classes of objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#it-s-science-time">It’s science time!</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-summary">6.7. In summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problems">6.8. Problems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regulars">Regulars</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-1">Problem 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-2">Problem 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-3">Problem 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-4">Problem 4</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-meanies">Semi-meanies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-5">Problem 5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-6">Problem 6</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meanie-1-netflix-economist">Meanie 1 – Netflix Economist</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meanie-2-star-sleuth">Meanie 2 – Star Sleuth</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike McCracken
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>